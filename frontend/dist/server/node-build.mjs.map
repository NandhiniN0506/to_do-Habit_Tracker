{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Reverse proxy to Flask when configured\n  const FLASK_API_URL = process.env.FLASK_API_URL;\n  if (FLASK_API_URL) {\n    const shouldProxy = (path: string) =>\n      path.startsWith(\"/tasks\") ||\n      path.startsWith(\"/analytics\") ||\n      path.startsWith(\"/motivation\") ||\n      path.startsWith(\"/login\") ||\n      path.startsWith(\"/register\") ||\n      path.startsWith(\"/signup\") ||\n      path.startsWith(\"/google-login\") ||\n      path.startsWith(\"/wellness\");\n\n    app.use(async (req, res, next) => {\n      try {\n        // Let SPA routes (HTML navigations) be handled by Vite/React Router\n        const accept = (req.headers[\"accept\"] || \"\").toString();\n        if (req.method === \"GET\" && accept.includes(\"text/html\")) return next();\n        if (!shouldProxy(req.path)) return next();\n        const url = new URL(req.originalUrl, FLASK_API_URL);\n        const headers = new Headers();\n        for (const [k, v] of Object.entries(req.headers)) {\n          if (v === undefined) continue;\n          const lower = k.toLowerCase();\n          if (lower === \"host\" || lower === \"content-length\" || lower === \"connection\" || lower === \"accept-encoding\") continue;\n          headers.set(k, Array.isArray(v) ? v.join(\",\") : String(v));\n        }\n        const hasBody = !(req.method === \"GET\" || req.method === \"HEAD\");\n        const init: RequestInit = {\n          method: req.method,\n          headers,\n          body: hasBody ? JSON.stringify(req.body || {}) : undefined,\n        };\n        const resp = await fetch(url, init);\n        res.status(resp.status);\n        resp.headers.forEach((val, key) => {\n          const k = key.toLowerCase();\n          if (k === \"content-encoding\" || k === \"transfer-encoding\" || k === \"content-length\") return;\n          res.setHeader(key, val);\n        });\n        const buf = Buffer.from(await resp.arrayBuffer());\n        res.send(buf);\n      } catch (e) {\n        res.status(502).json({ message: \"Proxy error\", error: (e as Error).message });\n      }\n    });\n  }\n\n  // Example API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express","path"],"mappings":"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"}